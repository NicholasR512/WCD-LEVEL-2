<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Current Jobs</title>
</head>
<%- include('../partials/header.ejs') %>
<%- include('../partials/errorMessage.ejs') %>
<body>
    <h1>Current Jobs</h1>

    <!-- Search, Sort, and Filter Form -->
    <form action="/jobs" method="GET">
        <!-- Search -->
        <input type="text" name="search" placeholder="Search by title or description" value="<%= query.search || '' %>">

        <!-- Filter by City -->
        <select name="city">
            <option value="">All Cities</option>
            <option value="Easton" <%= query.city === 'Easton' ? 'selected' : '' %>>Easton</option>
            <option value="Wilson" <%= query.city === 'Wilson' ? 'selected' : '' %>>Wilson</option>
            <option value="Bethlehem" <%= query.city === 'Bethlehem' ? 'selected' : '' %>>Bethlehem</option>
            <option value="Nazareth" <%= query.city === 'Nazareth' ? 'selected' : '' %>>Nazareth</option>
        </select>

        <!-- Filter by Job Type -->
        <select name="jobType">
            <option value="">All Job Types</option>
            <option value="Full Time" <%= query.jobType === 'Full Time' ? 'selected' : '' %>>Full Time</option>
            <option value="Part Time" <%= query.jobType === 'Part Time' ? 'selected' : '' %>>Part Time</option>
        </select>

        <!-- Filter by Salary -->
        <input type="number" name="minSalary" placeholder="Min Pay Per Hour" value="<%= query.minSalary || '' %>">

        <!-- Sort -->
        <select name="sort">
            <option value="">Sort By</option>
            <option value="date" <%= query.sort === 'date' ? 'selected' : '' %>>Newest</option>
            <option value="salary" <%= query.sort === 'salary' ? 'selected' : '' %>>Salary</option>
        </select>

        <button type="submit">Search</button>
        <!-- Reset Filters Button -->
        <a href="/jobs" class="reset-button">Reset Filters</a>
    </form>

    <% if (jobs.length === 0) { %>
        <p>No jobs to display.</p>
    <% } else { %>
        <% jobs.forEach(job => { %>
            <div>
                <h3><%= job.title %></h3>
                <p>Company: <%= job.company %></p>
                <p>City: <%= job.city %></p>
                <p>Type: <%= job.jobType %></p>
                <p>Salary: $<%= job.minSalary %> - $<%= job.maxSalary %></p>
                <p>Posted: <%= job.createdAt.toDateString() %></p>
                <a href="/jobs/<%= job.id %>">View</a>
                <% if (user.role === 'Admin' || (user.role === 'Business' && job.businessEmail === user.email)) { %>
                    <p>Status: <strong><%= job.status %></strong></p>
                    <a href="/jobs/<%= job.id %>/edit">Edit</a>
                    <%- include('../partials/deleteForm', { url: `/jobs/${job.id}` }) %>
                <% } %>
            </div>
            <hr>
        <% }) %>
    <% } %>
</body>
</html>
